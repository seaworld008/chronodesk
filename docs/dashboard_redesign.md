# 工单管理系统数据大屏重设计方案

## 1. 目标与原则
- **统一视角**：一次概览运营健康度、处理效率和风险预警，避免在多个页面来回切换。
- **实时联动**：仪表盘中的维度（时间、来源、优先级等）与工单列表、自动化、通知等模块共享同一数据过滤条件，实现“看数即可落地行动”。
- **角色自适应**：根据管理员、主管、客服代理不同的职责，动态呈现最有价值的信息与操作入口。
- **现代化体验**：采用网格化布局、卡片化信息、动态图表与亮暗色兼容设计，符合行业大屏设计规范（视觉层级清晰、色彩含义明确、留白合理、动静结合）。

## 2. 信息架构
```
┌──────────────────────────────────────────────────────────────┐
│ 顶部导航区：Logo / 环境标识 / 时间与刷新状态 / 快捷操作（导出 / 订阅） │
├──────────────────────────────────────────────────────────────┤
│ KPI 总览（4~6 个核心指标卡，可切换日 / 周 / 月）                     │
│ - 工单总量 / 当日新增 / 同比增幅                                 │
│ - SLA 合规率 / 平均首次响应时长 / 平均解决时长                     │
│ - 自动化覆盖率 / 实时在线客服数                                   │
├──────────────────────────────────────────────────────────────┤
│ 左：趋势分析                                                       │
│ - 工单量趋势（堆叠面积图：来源 × 状态）                            │
│ - 响应 & 解决时长分布（箱线图）                                   │
│ 右：分布洞察                                                       │
│ - 业务线 / 产品线热力矩阵                                         │
│ - 优先级 × SLA 风险气泡图                                         │
├──────────────────────────────────────────────────────────────┤
│ 左：实时监控卡                                                     │
│ - 正在处理的工单流（列表 + 倒计时）                                │
│ - 异常告警（SLA 即将逾期 / 自动化失败 / 通知发送失败）             │
│ 右：驱动行动区                                                     │
│ - 自动化规则执行统计 + 快捷跳转                                   │
│ - 待审批 / 待审核事项                                              │
│ - 今日客服绩效排行榜（处理量 / 满意度）                            │
├──────────────────────────────────────────────────────────────┤
│ 底部：深度分析                                                     │
│ - 工单漏斗（创建→分配→处理→解决→关闭）                           │
│ - 客户满意度雷达图                                                 │
│ - 通知渠道投放效果（邮件 / WebSocket / 企业IM）                    │
└──────────────────────────────────────────────────────────────┘
```

## 3. 数据来源与接口联动
| 模块 | 数据来源 | 说明 |
| ---- | -------- | ---- |
| KPI 卡片 | `/api/tickets/stats` （已有） + 新增 `/api/admin/analytics/system` | 后端新增字段：`avg_first_response_minutes`、`avg_resolution_minutes`、`automation_success_rate`、`active_agents`。|
| 趋势图 | 新增 `/api/admin/analytics/tickets/timeseries?granularity=day&range=30d` | 返回数组：`[{ date, total, sources: { web: x, email: y, ... }, statuses: { open: x, ... } }]`。|
| SLA 风险 | 新增 `/api/admin/analytics/sla/risk` | 按优先级输出紧迫工单列表及预计违约时间。|
| 自动化统计 | 复用 `automation/logs`、`automation/rules` 接口，增加聚合字段（成功率、平均耗时）。|
| 客服绩效 | 新增 `/api/admin/analytics/agents/performance?range=today` | 返回处理量、解决率、满意度评分。|
| 通知效果 | 复用 `notifications` + 新增 `/api/admin/analytics/notifications/summary`。|

> **联动策略**：仪表盘内所有图表冒泡 `filterContext`（React Context）。列表页、自动化页、通知页订阅该上下文，实现跨页面的过滤条件同步；例如点击“来源：Email”后跳转工单列表自动带入 `source=email`。

## 4. 交互设计
1. **全局过滤器**：右上角提供时间范围、业务线、渠道、优先级选择器，联动全局。
2. **下钻**：点击任意卡片或图表元素，侧边滑出详细列表（支持直接分配、升级、添加备注）。
3. **实时刷新策略**：
   - KPI 和告警区使用 WebSocket 推送（复用现有通知通道）。
   - 趋势图与深度分析按用户配置的刷新频次（默认 5 分钟）轮询。
4. **导出与订阅**：支持 CSV / PDF 导出；管理员可一键订阅每日邮件快报（复用通知系统模板）。
5. **响应式布局**：在 1920×1080 大屏保持三行布局，在 1366 宽度自动变为两列，移动端只保留 KPI + 待处理 + 告警。

## 5. 视觉与组件规范
- **色彩**：遵循品牌主色 `#3B82F6`，警告 `#F97316`，危险 `#EF4444`，成功 `#10B981`；使用柔和渐变背景强调趋势图。
- **排版**：主标题 24px，副标题 16px，指标数字 32px-48px；负空间 24px，卡片圆角 16px。
- **图表库**：建议统一使用 `Apache ECharts`（或 `Recharts`）提供动画、渐变、联动高亮能力；封装为 `DashboardChart` 组件，支持 Loading Skeleton。
- **可访问性**：为色盲用户提供形状区分、可选高对比主题；所有动态区域提供语义化 `aria-live`。

## 6. 前端实现规划
1. **信息容器**：新增 `web/src/admin/dashboard/DashboardLayout.tsx`，封装过滤器栏、内容网格、FilterContext。
2. **图表组件**：
   - `KpiCard`, `TrendAreaChart`, `SlaRiskBubble`, `AutomationSummary`, `AgentLeaderboard`, `NotificationFunnel` 等。
   - 组件均接受 `filters` 与 `onFilterChange` 回调，便于与列表共享。
3. **数据层**：
   - 在 `web/src/lib/dataProvider.ts` 增加 `dashboardProvider` 或使用 `react-query` 自定义 hooks：`useTicketTimeseries`, `useSlaRisk`, `useAutomationMetrics`。
   - 错误提示统一通过 `useNotify` 弹出并写入观测日志。
4. **状态管理**：采用 `useReducer` + Context 存储全局筛选条件，提供 `DashboardFilterProvider` 包裹仪表盘与需要联动的页面。
5. **渐进交付**：
   - 第一期：KPI + 趋势 + 紧急 / 我的工单联动。
   - 第二期：自动化、通知效果、客服排行。
   - 第三期：漏斗 & 满意度 & 深度分析模块。

## 7. 后端扩展清单
1. 新增统计接口：
   - `/api/admin/analytics/tickets/timeseries`
   - `/api/admin/analytics/sla/risk`
   - `/api/admin/analytics/agents/performance`
   - `/api/admin/analytics/notifications/summary`
2. 增强现有 `/api/tickets/stats` 返回字段。
3. 引入缓存层（如 Redis）缓存大屏聚合结果，设置 1 分钟 TTL。
4. 在自动化、通知服务中埋点执行时长与状态，写入 `analytics_metrics` 表。

## 8. 联动场景举例
- **SLA 告警 → 工单详情**：点击风险列表项，打开工单详情侧栏，可直接重新分配或升级。
- **自动化失败 → 规则编辑**：点击失败条目跳转到自动化规则显示页，侧边展示最近 5 次执行日志。
- **客服绩效 → 用户管理**：点击头像跳转用户详情，展示处理轨迹与培训建议。
- **通知效果 → 通知设置**：点击渠道卡片跳转通知模块，自动选中渠道标签。

## 9. 验收标准
1. 页面首屏加载时间 ≤ 2s（缓存命中情况下）。
2. KPI 更新延迟 ≤ 5s，趋势图滑动平均误差 ≤ 2%。
3. 关键操作（分配、升级、导出）可在 2 次点击内完成。
4. 通过响应式与无障碍测试。
5. 与工单列表、自动化、通知等页面的跳转与过滤同步稳定。

## 10. 下一步行动
1. 与后端确认新增统计接口与缓存方案，整理 API 文档。
2. 评估引入 `echarts-for-react`，搭建图表组件库与主题。
3. 按阶段拆分实施任务（FE/BE/QA），规划里程碑与演示版。
4. 与运营团队对齐 KPI 定义、颜色含义及阈值策略。
5. 在 `docs/` 目录维护交互稿（Figma）与真实数据示例。

---
该方案旨在将仪表盘升级为实时、联动、可执行的运营控制塔，为后续自动化、AI 预测等高级能力打好数据与交互基础。
