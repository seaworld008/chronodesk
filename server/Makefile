# å·¥å•ç³»ç»Ÿ Makefile

.PHONY: help build run migrate migrate-all migrate-tables migrate-indexes migrate-seed clean test

# é»˜è®¤ç›®æ ‡
help:
	@echo "å·¥å•ç³»ç»Ÿæ„å»ºå’Œç®¡ç†å·¥å…·"
	@echo ""
	@echo "å¯ç”¨å‘½ä»¤:"
	@echo "  build          æ„å»ºæœåŠ¡å™¨"
	@echo "  run            è¿è¡ŒæœåŠ¡å™¨ï¼ˆä¸è‡ªåŠ¨è¿ç§»ï¼‰"
	@echo "  run-migrate    è¿è¡ŒæœåŠ¡å™¨ï¼ˆå¯ç”¨è‡ªåŠ¨è¿ç§»ï¼‰"
	@echo "  migrate-fast   å¿«é€Ÿæ•°æ®åº“è¿ç§»ï¼ˆæ¨èï¼‰"
	@echo "  build-migrate  æ„å»ºå¿«é€Ÿè¿ç§»å·¥å…·"
	@echo "  migrate-all    æ‰§è¡Œå®Œæ•´æ•°æ®åº“è¿ç§»ï¼ˆæ—§ç‰ˆï¼Œè¾ƒæ…¢ï¼‰"
	@echo "  migrate-tables åªè¿ç§»æ•°æ®åº“è¡¨ç»“æ„ï¼ˆæ—§ç‰ˆï¼‰"
	@echo "  migrate-indexes åªåˆ›å»ºæ•°æ®åº“ç´¢å¼•ï¼ˆæ—§ç‰ˆï¼‰"
	@echo "  migrate-seed   åªåˆå§‹åŒ–ç§å­æ•°æ®ï¼ˆæ—§ç‰ˆï¼‰"
	@echo "  clean          æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo "  test           è¿è¡Œæµ‹è¯•"
	@echo "  help           æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"

# æ„å»ºæœåŠ¡å™¨
build:
	@echo "æ„å»ºæœåŠ¡å™¨..."
	go build -o bin/server main.go
	@echo "æ„å»ºå®Œæˆ: bin/server"

# è¿è¡ŒæœåŠ¡å™¨ï¼ˆä¸è‡ªåŠ¨è¿ç§»ï¼‰
run:
	@echo "å¯åŠ¨æœåŠ¡å™¨ï¼ˆè·³è¿‡è‡ªåŠ¨è¿ç§»ï¼‰..."
	go run main.go

# è¿è¡ŒæœåŠ¡å™¨ï¼ˆå¯ç”¨è‡ªåŠ¨è¿ç§»ï¼‰
run-migrate:
	@echo "å¯åŠ¨æœåŠ¡å™¨ï¼ˆå¯ç”¨è‡ªåŠ¨è¿ç§»ï¼‰..."
	AUTO_MIGRATE=true go run main.go

# æ•°æ®åº“è¿ç§»å‘½ä»¤ï¼ˆæ–°ç‰ˆ - åŸºäºGORM AutoMigrateï¼Œé«˜æ•ˆå¿«é€Ÿï¼‰
migrate:
	@echo "ğŸš€ æ‰§è¡Œæ•°æ®åº“è¿ç§»..."
	@go run cmd/migrate/main.go

migrate-seed:
	@echo "ğŸŒ± æ‰§è¡Œæ•°æ®åº“è¿ç§»å¹¶å¡«å……ç§å­æ•°æ®..."
	@go run cmd/migrate/main.go -seed

migrate-drop:
	@echo "âš ï¸  åˆ é™¤æ‰€æœ‰è¡¨å¹¶é‡æ–°è¿ç§»ï¼ˆå±é™©æ“ä½œï¼‰..."
	@go run cmd/migrate/main.go -drop -seed

migrate-verbose:
	@echo "ğŸ“ æ‰§è¡Œè¯¦ç»†æ•°æ®åº“è¿ç§»..."
	@go run cmd/migrate/main.go -v -seed

# æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	@echo "æ¸…ç†æ„å»ºæ–‡ä»¶..."
	rm -rf bin/
	@echo "æ¸…ç†å®Œæˆ"

# è¿è¡Œæµ‹è¯•
test:
	@echo "è¿è¡Œæµ‹è¯•..."
	go test ./...

# å®‰è£…ä¾èµ–
deps:
	@echo "å®‰è£…ä¾èµ–..."
	go mod download
	go mod tidy

# æ ¼å¼åŒ–ä»£ç 
fmt:
	@echo "æ ¼å¼åŒ–ä»£ç ..."
	go fmt ./...

# ä»£ç æ£€æŸ¥
vet:
	@echo "ä»£ç æ£€æŸ¥..."
	go vet ./...

# å¼€å‘ç¯å¢ƒè®¾ç½®
dev-setup: deps
	@echo "è®¾ç½®å¼€å‘ç¯å¢ƒ..."
	@if [ ! -f .env ]; then cp .env.example .env; echo "å·²åˆ›å»º .env æ–‡ä»¶ï¼Œè¯·æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®"; fi
	@echo "å¼€å‘ç¯å¢ƒè®¾ç½®å®Œæˆ"

# ç”Ÿäº§ç¯å¢ƒæ„å»º
build-prod:
	@echo "ç”Ÿäº§ç¯å¢ƒæ„å»º..."
	CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o bin/server main.go
	@echo "ç”Ÿäº§ç¯å¢ƒæ„å»ºå®Œæˆ: bin/server"